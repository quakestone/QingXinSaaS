{"remainingRequest":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\src\\components\\Process\\panel\\taskListener.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\src\\components\\Process\\panel\\taskListener.vue","mtime":1733705220399},{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBsaXN0TGlzdGVuZXIgfSBmcm9tICJAL2FwaS9mbG93YWJsZS9saXN0ZW5lciI7DQppbXBvcnQgew0KICBjaGFuZ2VMaXN0ZW5lck9iamVjdCwNCiAgY3JlYXRlTGlzdGVuZXJPYmplY3QsDQogIGNyZWF0ZVN5c3RlbUxpc3RlbmVyT2JqZWN0LA0KICB1cGRhdGVFbGVtZW50RXh0ZW5zaW9ucw0KfSBmcm9tICIuLi9jb21tb24vYnBtblV0aWxzIjsNCg0KaW1wb3J0IHtTdHJVdGlsfSBmcm9tICJAL3V0aWxzL1N0clV0aWwiOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJUYXNrTGlzdGVuZXIiLA0KICAvLyDlhoXnva7nm5HlkKzlmajnm7jlhbPkv6Hmga8NCiAgZGljdHM6IFsnc3lzX2xpc3RlbmVyX3ZhbHVlX3R5cGUnLCAnc3lzX2xpc3RlbmVyX2V2ZW50X3R5cGUnXSwNCiAgLyoqIOe7hOS7tuS8oOWAvCAgKi8NCiAgcHJvcHMgOiB7DQogICAgaWQ6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIHJlcXVpcmVkOiB0cnVlDQogICAgfSwNCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgZWxlbWVudExpc3RlbmVyc0xpc3Q6IFtdLCAvLyDnm5HlkKzlmajliJfooagNCiAgICAgIGxpc3RlbmVyRm9ybToge30sLy8g55uR5ZCs5Zmo6K+m5oOF6KGo5Y2VDQogICAgICBsaXN0ZW5lckZvcm1Nb2RlbFZpc2libGU6IGZhbHNlLCAvLyDnm5HlkKzlmagg57yW6L6RIOS+p+i+ueagj+aYvuekuueKtuaAgQ0KICAgICAgZmllbGRzTGlzdE9mTGlzdGVuZXI6IFtdLA0KICAgICAgYnBtbkVsZW1lbnRMaXN0ZW5lcnM6IFtdLA0KICAgICAgb3RoZXJFeHRlbnNpb25MaXN0OiBbXSwNCiAgICAgIGxpc3RlbmVyRmllbGRGb3JtOiB7fSwgLy8g55uR5ZCs5ZmoIOazqOWFpeWtl+autSDor6bmg4XooajljZUNCiAgICAgIGxpc3RlbmVyRmllbGRGb3JtTW9kZWxWaXNpYmxlOiBmYWxzZSwgLy8g55uR5ZCs5ZmoIOazqOWFpeWtl+auteihqOWNleW8ueeqlyDmmL7npLrnirbmgIENCiAgICAgIGVkaXRpbmdMaXN0ZW5lckluZGV4OiAtMSwgLy8g55uR5ZCs5Zmo5omA5Zyo5LiL5qCH77yMLTEg5Li65paw5aKeDQogICAgICBlZGl0aW5nTGlzdGVuZXJGaWVsZEluZGV4OiAtMSwgLy8g5a2X5q615omA5Zyo5LiL5qCH77yMLTEg5Li65paw5aKeDQoNCiAgICAgIGxpc3RlbmVyTGlzdDogW10sDQogICAgICBjaGVja2VkTGlzdGVuZXJEYXRhOiBbXSwNCiAgICAgIGxpc3RlbmVyU3lzdGVtVmlzaWJsZTogZmFsc2UsDQogICAgICBsaXN0ZW5lclN5c3RlbUNoZWNrZWQ6IHRydWUsDQogICAgICBsb2FkaW5nOiB0cnVlLA0KICAgICAgdG90YWw6IDAsDQogICAgICBsaXN0ZW5lclR5cGVPYmplY3Q6IHsNCiAgICAgICAgY2xhc3NMaXN0ZW5lcjogIkphdmEg57G7IiwNCiAgICAgICAgZXhwcmVzc2lvbkxpc3RlbmVyOiAi6KGo6L6+5byPIiwNCiAgICAgICAgZGVsZWdhdGVFeHByZXNzaW9uTGlzdGVuZXI6ICLku6PnkIbooajovr7lvI8iLA0KICAgICAgICBzY3JpcHRMaXN0ZW5lcjogIuiEmuacrCINCiAgICAgIH0sDQogICAgICBsaXN0ZW5lckV2ZW50VHlwZU9iamVjdDp7DQogICAgICAgIGNyZWF0ZTogIuWIm+W7uiIsDQogICAgICAgIGFzc2lnbm1lbnQ6ICLmjIfmtL4iLA0KICAgICAgICBjb21wbGV0ZTogIuWujOaIkCIsDQogICAgICAgIGRlbGV0ZTogIuWIoOmZpCIsDQogICAgICAgIC8vIHVwZGF0ZTogIuabtOaWsCIsDQogICAgICAgIC8vIHRpbWVvdXQ6ICLotoXml7YiDQogICAgICB9LA0KICAgICAgZmllbGRUeXBlT2JqZWN0OnsNCiAgICAgICAgc3RyaW5nOiAi5a2X56ym5LiyIiwNCiAgICAgICAgZXhwcmVzc2lvbjogIuihqOi+vuW8jyINCiAgICAgIH0sDQogICAgICBxdWVyeVBhcmFtczogew0KICAgICAgICBwYWdlTnVtOiAxLA0KICAgICAgICBwYWdlU2l6ZTogMTAsDQogICAgICAgIHR5cGU6IDEsDQogICAgICB9LA0KICAgIH0NCiAgfSwNCg0KICAvKiog5Lyg5YC855uR5ZCsICovDQogIHdhdGNoOiB7DQogICAgaWQ6IHsNCiAgICAgIGhhbmRsZXIobmV3VmFsKSB7DQogICAgICAgIGlmIChTdHJVdGlsLmlzTm90QmxhbmsobmV3VmFsKSkgew0KICAgICAgICAgIHRoaXMucmVzZXRMaXN0ZW5lcnNMaXN0KCk7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICBpbW1lZGlhdGU6IHRydWUsIC8vIOeri+WNs+eUn+aViA0KICAgIH0sDQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5nZXRMaXN0KCk7DQoNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHJlc2V0TGlzdGVuZXJzTGlzdCgpIHsNCiAgICAgIHRoaXMuYnBtbkVsZW1lbnRMaXN0ZW5lcnMgPQ0KICAgICAgICB0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LmJ1c2luZXNzT2JqZWN0Py5leHRlbnNpb25FbGVtZW50cz8udmFsdWVzPy5maWx0ZXIoZXggPT4gZXguJHR5cGUgPT09IGBmbG93YWJsZTpUYXNrTGlzdGVuZXJgKSA/PyBbXTsNCiAgICAgIHRoaXMuZWxlbWVudExpc3RlbmVyc0xpc3QgPSB0aGlzLmJwbW5FbGVtZW50TGlzdGVuZXJzLm1hcChsaXN0ZW5lciA9PiB0aGlzLmluaXRMaXN0ZW5lclR5cGUobGlzdGVuZXIpKTsNCiAgICAgIHRoaXMuJGVtaXQoJ2dldFRhc2tMaXN0ZW5lckNvdW50JywgdGhpcy5lbGVtZW50TGlzdGVuZXJzTGlzdC5sZW5ndGgpDQogICAgfSwNCg0KICAgIC8vIOaJk+W8gCDnm5HlkKzlmajor6bmg4Ug5L6n6L655qCPDQogICAgb3Blbkxpc3RlbmVyRm9ybShsaXN0ZW5lciwgaW5kZXgpIHsNCiAgICAgIGlmIChsaXN0ZW5lcikgew0KICAgICAgICB0aGlzLmxpc3RlbmVyRm9ybSA9IHRoaXMuaW5pdExpc3RlbmVyRm9ybShsaXN0ZW5lcik7DQogICAgICAgIHRoaXMuZWRpdGluZ0xpc3RlbmVySW5kZXggPSBpbmRleDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMubGlzdGVuZXJGb3JtID0ge307DQogICAgICAgIHRoaXMuZWRpdGluZ0xpc3RlbmVySW5kZXggPSAtMTsgLy8g5qCH6K6w5Li65paw5aKeDQogICAgICB9DQogICAgICBpZiAobGlzdGVuZXIgJiYgbGlzdGVuZXIuZmllbGRzKSB7DQogICAgICAgIHRoaXMuZmllbGRzTGlzdE9mTGlzdGVuZXIgPSBsaXN0ZW5lci5maWVsZHMubWFwKGZpZWxkID0+ICh7DQogICAgICAgICAgLi4uZmllbGQsDQogICAgICAgICAgZmllbGRUeXBlOiBmaWVsZC5zdHJpbmcgPyAic3RyaW5nIiA6ICJleHByZXNzaW9uIg0KICAgICAgICB9KSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmZpZWxkc0xpc3RPZkxpc3RlbmVyID0gW107DQogICAgICAgIHRoaXMuJHNldCh0aGlzLmxpc3RlbmVyRm9ybSwgImZpZWxkcyIsIFtdKTsNCiAgICAgIH0NCiAgICAgIC8vIOaJk+W8gOS+p+i+ueagj+W5tua4healmumqjOivgeeKtuaAgQ0KICAgICAgdGhpcy5saXN0ZW5lckZvcm1Nb2RlbFZpc2libGUgPSB0cnVlOw0KICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICBpZiAodGhpcy4kcmVmc1sibGlzdGVuZXJGb3JtUmVmIl0pIHRoaXMuJHJlZnNbImxpc3RlbmVyRm9ybVJlZiJdLmNsZWFyVmFsaWRhdGUoKTsNCiAgICAgIH0pOw0KICAgIH0sDQoNCiAgICAvLyDmiZPlvIDnm5HlkKzlmajlrZfmrrXnvJbovpHlvLnnqpcNCiAgICBvcGVuTGlzdGVuZXJGaWVsZEZvcm0oZmllbGQsIGluZGV4KSB7DQogICAgICB0aGlzLmxpc3RlbmVyRmllbGRGb3JtID0gZmllbGQgPyBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGZpZWxkKSkgOiB7fTsNCiAgICAgIHRoaXMuZWRpdGluZ0xpc3RlbmVyRmllbGRJbmRleCA9IGZpZWxkID8gaW5kZXggOiAtMTsNCiAgICAgIHRoaXMubGlzdGVuZXJGaWVsZEZvcm1Nb2RlbFZpc2libGUgPSB0cnVlOw0KICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICBpZiAodGhpcy4kcmVmc1sibGlzdGVuZXJGaWVsZEZvcm1SZWYiXSkgdGhpcy4kcmVmc1sibGlzdGVuZXJGaWVsZEZvcm1SZWYiXS5jbGVhclZhbGlkYXRlKCk7DQogICAgICB9KTsNCiAgICB9LA0KDQogICAgLy8g5L+d5a2Y55uR5ZCs5Zmo5rOo5YWl5a2X5q61DQogICAgYXN5bmMgc2F2ZUxpc3RlbmVyRmlsZWQoKSB7DQogICAgICBsZXQgdmFsaWRhdGVTdGF0dXMgPSBhd2FpdCB0aGlzLiRyZWZzWyJsaXN0ZW5lckZpZWxkRm9ybVJlZiJdLnZhbGlkYXRlKCk7DQogICAgICBpZiAoIXZhbGlkYXRlU3RhdHVzKSByZXR1cm47IC8vIOmqjOivgeS4jemAmui/h+ebtOaOpei/lOWbng0KICAgICAgaWYgKHRoaXMuZWRpdGluZ0xpc3RlbmVyRmllbGRJbmRleCA9PT0gLTEpIHsNCiAgICAgICAgdGhpcy5maWVsZHNMaXN0T2ZMaXN0ZW5lci5wdXNoKHRoaXMubGlzdGVuZXJGaWVsZEZvcm0pOw0KICAgICAgICB0aGlzLmxpc3RlbmVyRm9ybS5maWVsZHMucHVzaCh0aGlzLmxpc3RlbmVyRmllbGRGb3JtKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuZmllbGRzTGlzdE9mTGlzdGVuZXIuc3BsaWNlKHRoaXMuZWRpdGluZ0xpc3RlbmVyRmllbGRJbmRleCwgMSwgdGhpcy5saXN0ZW5lckZpZWxkRm9ybSk7DQogICAgICAgIHRoaXMubGlzdGVuZXJGb3JtLmZpZWxkcy5zcGxpY2UodGhpcy5lZGl0aW5nTGlzdGVuZXJGaWVsZEluZGV4LCAxLCB0aGlzLmxpc3RlbmVyRmllbGRGb3JtKTsNCiAgICAgIH0NCiAgICAgIHRoaXMubGlzdGVuZXJGaWVsZEZvcm1Nb2RlbFZpc2libGUgPSBmYWxzZTsNCiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+ICh0aGlzLmxpc3RlbmVyRmllbGRGb3JtID0ge30pKTsNCiAgICB9LA0KDQogICAgLy8g56e76Zmk55uR5ZCs5Zmo5a2X5q61DQogICAgcmVtb3ZlTGlzdGVuZXJGaWVsZChmaWVsZCwgaW5kZXgpIHsNCiAgICAgIHRoaXMuJGNvbmZpcm0oIuehruiupOenu+mZpOivpeWtl+auteWQl++8nyIsICLmj5DnpLoiLCB7DQogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAi56GuIOiupCIsDQogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICLlj5Yg5raIIg0KICAgICAgfSkudGhlbigoKSA9PiB7DQogICAgICAgIHRoaXMuZmllbGRzTGlzdE9mTGlzdGVuZXIuc3BsaWNlKGluZGV4LCAxKTsNCiAgICAgICAgdGhpcy5saXN0ZW5lckZvcm0uZmllbGRzLnNwbGljZShpbmRleCwgMSk7DQogICAgICB9KS5jYXRjaCgoKSA9PiBjb25zb2xlLmluZm8oIuaTjeS9nOWPlua2iCIpKTsNCiAgICB9LA0KDQogICAgLy8g56e76Zmk55uR5ZCs5ZmoDQogICAgcmVtb3ZlTGlzdGVuZXIobGlzdGVuZXIsIGluZGV4KSB7DQogICAgICB0aGlzLiRjb25maXJtKCLnoa7orqTnp7vpmaTor6Xnm5HlkKzlmajlkJfvvJ8iLCAi5o+Q56S6Iiwgew0KICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIuehriDorqQiLA0KICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAi5Y+WIOa2iCINCiAgICAgIH0pLnRoZW4oKCkgPT4gew0KICAgICAgICB0aGlzLmJwbW5FbGVtZW50TGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7DQogICAgICAgIHRoaXMuZWxlbWVudExpc3RlbmVyc0xpc3Quc3BsaWNlKGluZGV4LCAxKTsNCiAgICAgICAgdXBkYXRlRWxlbWVudEV4dGVuc2lvbnModGhpcy5tb2RlbGVyU3RvcmUubW9kZGxlLCB0aGlzLm1vZGVsZXJTdG9yZS5tb2RlbGluZywgdGhpcy5tb2RlbGVyU3RvcmUuZWxlbWVudCwgdGhpcy5vdGhlckV4dGVuc2lvbkxpc3QuY29uY2F0KHRoaXMuYnBtbkVsZW1lbnRMaXN0ZW5lcnMpKTsNCiAgICAgICAgdGhpcy4kZW1pdCgnZ2V0VGFza0xpc3RlbmVyQ291bnQnLCB0aGlzLmVsZW1lbnRMaXN0ZW5lcnNMaXN0Lmxlbmd0aCkNCiAgICAgIH0pLmNhdGNoKChyKSA9PiBjb25zb2xlLmluZm8ociwgIuaTjeS9nOWPlua2iCIpKTsNCiAgICB9LA0KDQogICAgLy8g5L+d5a2Y55uR5ZCs5Zmo6YWN572uDQogICAgYXN5bmMgc2F2ZUxpc3RlbmVyQ29uZmlnKCkgew0KICAgICAgbGV0IHZhbGlkYXRlU3RhdHVzID0gYXdhaXQgdGhpcy4kcmVmc1sibGlzdGVuZXJGb3JtUmVmIl0udmFsaWRhdGUoKTsNCiAgICAgIGlmICghdmFsaWRhdGVTdGF0dXMpIHJldHVybjsgLy8g6aqM6K+B5LiN6YCa6L+H55u05o6l6L+U5ZueDQogICAgICBjb25zdCBsaXN0ZW5lck9iamVjdCA9IGNyZWF0ZUxpc3RlbmVyT2JqZWN0KHRoaXMubW9kZWxlclN0b3JlLm1vZGRsZSwgdGhpcy5saXN0ZW5lckZvcm0sIGZhbHNlLCAiZmxvd2FibGUiKTsNCiAgICAgIGlmICh0aGlzLmVkaXRpbmdMaXN0ZW5lckluZGV4ID09PSAtMSkgew0KICAgICAgICB0aGlzLmJwbW5FbGVtZW50TGlzdGVuZXJzLnB1c2gobGlzdGVuZXJPYmplY3QpOw0KICAgICAgICB0aGlzLmVsZW1lbnRMaXN0ZW5lcnNMaXN0LnB1c2godGhpcy5saXN0ZW5lckZvcm0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5icG1uRWxlbWVudExpc3RlbmVycy5zcGxpY2UodGhpcy5lZGl0aW5nTGlzdGVuZXJJbmRleCwgMSwgbGlzdGVuZXJPYmplY3QpOw0KICAgICAgICB0aGlzLmVsZW1lbnRMaXN0ZW5lcnNMaXN0LnNwbGljZSh0aGlzLmVkaXRpbmdMaXN0ZW5lckluZGV4LCAxLCB0aGlzLmxpc3RlbmVyRm9ybSk7DQogICAgICB9DQogICAgICAvLyDkv53lrZjlhbbku5bphY3nva4NCiAgICAgIHRoaXMub3RoZXJFeHRlbnNpb25MaXN0ID0gdGhpcy5tb2RlbGVyU3RvcmUuZWxlbWVudC5idXNpbmVzc09iamVjdD8uZXh0ZW5zaW9uRWxlbWVudHM/LnZhbHVlcz8uZmlsdGVyKGV4ID0+IGV4LiR0eXBlICE9PSBgZmxvd2FibGU6VGFza0xpc3RlbmVyYCkgPz8gW107DQogICAgICB1cGRhdGVFbGVtZW50RXh0ZW5zaW9ucyh0aGlzLm1vZGVsZXJTdG9yZS5tb2RkbGUsIHRoaXMubW9kZWxlclN0b3JlLm1vZGVsaW5nLCB0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LCB0aGlzLm90aGVyRXh0ZW5zaW9uTGlzdC5jb25jYXQodGhpcy5icG1uRWxlbWVudExpc3RlbmVycykpOw0KICAgICAgdGhpcy4kZW1pdCgnZ2V0VGFza0xpc3RlbmVyQ291bnQnLCB0aGlzLmVsZW1lbnRMaXN0ZW5lcnNMaXN0Lmxlbmd0aCkNCiAgICAgIC8vIDQuIOmakOiXj+S+p+i+ueagjw0KICAgICAgdGhpcy5saXN0ZW5lckZvcm1Nb2RlbFZpc2libGUgPSBmYWxzZTsNCiAgICAgIHRoaXMubGlzdGVuZXJGb3JtID0ge307DQogICAgfSwNCg0KICAgIGluaXRMaXN0ZW5lclR5cGUobGlzdGVuZXIpIHsNCiAgICAgIGxldCBsaXN0ZW5lclR5cGU7DQogICAgICBpZiAobGlzdGVuZXIuY2xhc3MpIGxpc3RlbmVyVHlwZSA9ICJjbGFzc0xpc3RlbmVyIjsNCiAgICAgIGlmIChsaXN0ZW5lci5leHByZXNzaW9uKSBsaXN0ZW5lclR5cGUgPSAiZXhwcmVzc2lvbkxpc3RlbmVyIjsNCiAgICAgIGlmIChsaXN0ZW5lci5kZWxlZ2F0ZUV4cHJlc3Npb24pIGxpc3RlbmVyVHlwZSA9ICJkZWxlZ2F0ZUV4cHJlc3Npb25MaXN0ZW5lciI7DQogICAgICBpZiAobGlzdGVuZXIuc2NyaXB0KSBsaXN0ZW5lclR5cGUgPSAic2NyaXB0TGlzdGVuZXIiOw0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShsaXN0ZW5lcikpLA0KICAgICAgICAuLi4obGlzdGVuZXIuc2NyaXB0ID8/IHt9KSwNCiAgICAgICAgbGlzdGVuZXJUeXBlOiBsaXN0ZW5lclR5cGUNCiAgICAgIH07DQogICAgfSwNCg0KICAgIC8vIOWIneWni+WMluihqOWNleaVsOaNrg0KICAgIGluaXRMaXN0ZW5lckZvcm0obGlzdGVuZXIpIHsNCiAgICAgIGxldCBzZWxmID0gew0KICAgICAgICAuLi5saXN0ZW5lcg0KICAgICAgfTsNCiAgICAgIGlmIChsaXN0ZW5lci5zY3JpcHQpIHsNCiAgICAgICAgc2VsZiA9IHsNCiAgICAgICAgICAuLi5saXN0ZW5lciwNCiAgICAgICAgICAuLi5saXN0ZW5lci5zY3JpcHQsDQogICAgICAgICAgc2NyaXB0VHlwZTogbGlzdGVuZXIuc2NyaXB0LnJlc291cmNlID8gImV4dGVybmFsU2NyaXB0IiA6ICJpbmxpbmVTY3JpcHQiDQogICAgICAgIH07DQogICAgICB9DQogICAgICBpZiAobGlzdGVuZXIuZXZlbnQgPT09ICJ0aW1lb3V0IiAmJiBsaXN0ZW5lci5ldmVudERlZmluaXRpb25zKSB7DQogICAgICAgIGlmIChsaXN0ZW5lci5ldmVudERlZmluaXRpb25zLmxlbmd0aCkgew0KICAgICAgICAgIGxldCBrID0gIiI7DQogICAgICAgICAgZm9yIChsZXQga2V5IGluIGxpc3RlbmVyLmV2ZW50RGVmaW5pdGlvbnNbMF0pIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGxpc3RlbmVyLmV2ZW50RGVmaW5pdGlvbnMsIGtleSk7DQogICAgICAgICAgICBpZiAoa2V5LmluZGV4T2YoInRpbWUiKSAhPT0gLTEpIHsNCiAgICAgICAgICAgICAgayA9IGtleTsNCiAgICAgICAgICAgICAgc2VsZi5ldmVudERlZmluaXRpb25UeXBlID0ga2V5LnJlcGxhY2UoInRpbWUiLCAiIikudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgY29uc29sZS5sb2coayk7DQogICAgICAgICAgc2VsZi5ldmVudFRpbWVEZWZpbml0aW9ucyA9IGxpc3RlbmVyLmV2ZW50RGVmaW5pdGlvbnNbMF1ba10uYm9keTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHNlbGY7DQogICAgfSwNCg0KDQogICAgLyoqIOafpeivoua1geeoi+i+vuW8j+WIl+ihqCAqLw0KICAgIGdldExpc3QoKSB7DQogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOw0KICAgICAgbGlzdExpc3RlbmVyKHRoaXMucXVlcnlQYXJhbXMpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICB0aGlzLmxpc3RlbmVyTGlzdCA9IHJlc3BvbnNlLnJvd3M7DQogICAgICAgIHRoaXMudG90YWwgPSByZXNwb25zZS50b3RhbDsNCiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7DQogICAgICB9KTsNCiAgICB9LA0KDQogICAgLy8g5aSa6YCJ5qGG6YCJ5Lit5pWw5o2uDQogICAgaGFuZGxlU2VsZWN0aW9uQ2hhbmdlKHNlbGVjdGlvbikgew0KICAgICAgLy8gaWRzLnZhbHVlID0gc2VsZWN0aW9uLm1hcChpdGVtID0+IGl0ZW0uaWQpOw0KICAgICAgLy8gVE9ETyDlupTor6Xkvb/nlKggcHVzaD8NCiAgICAgIHRoaXMuY2hlY2tlZExpc3RlbmVyRGF0YSA9IHNlbGVjdGlvbjsNCiAgICAgIHRoaXMubGlzdGVuZXJTeXN0ZW1DaGVja2VkID0gc2VsZWN0aW9uLmxlbmd0aCAhPT0gMTsNCiAgICB9LA0KDQogICAgLy8g5L+d5a2Y5YaF572u55uR5ZCs5ZmoDQogICAgc2F2ZVN5c3RlbUxpc3RlbmVyKCkgew0KICAgICAgaWYgKHRoaXMuY2hlY2tlZExpc3RlbmVyRGF0YS5sZW5ndGggPiAwKSB7DQogICAgICAgIHRoaXMuY2hlY2tlZExpc3RlbmVyRGF0YS5mb3JFYWNoKHZhbHVlID0+IHsNCiAgICAgICAgICAvLyDkv53lrZjlhbbku5bphY3nva4NCiAgICAgICAgICBjb25zdCBsaXN0ZW5lck9iamVjdCA9IGNyZWF0ZVN5c3RlbUxpc3RlbmVyT2JqZWN0KHRoaXMubW9kZWxlclN0b3JlLm1vZGRsZSwgdmFsdWUsIHRydWUsICJmbG93YWJsZSIpOw0KICAgICAgICAgIHRoaXMuYnBtbkVsZW1lbnRMaXN0ZW5lcnMucHVzaChsaXN0ZW5lck9iamVjdCk7DQogICAgICAgICAgdGhpcy5lbGVtZW50TGlzdGVuZXJzTGlzdC5wdXNoKGNoYW5nZUxpc3RlbmVyT2JqZWN0KHZhbHVlKSk7DQogICAgICAgICAgdGhpcy5vdGhlckV4dGVuc2lvbkxpc3QgPSB0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LmJ1c2luZXNzT2JqZWN0Py5leHRlbnNpb25FbGVtZW50cz8udmFsdWVzPy5maWx0ZXIoZXggPT4gZXguJHR5cGUgIT09IGBmbG93YWJsZTpUYXNrTGlzdGVuZXJgKSA/PyBbXTsNCiAgICAgICAgICB1cGRhdGVFbGVtZW50RXh0ZW5zaW9ucyh0aGlzLm1vZGVsZXJTdG9yZS5tb2RkbGUsIHRoaXMubW9kZWxlclN0b3JlLm1vZGVsaW5nLCB0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LCB0aGlzLm90aGVyRXh0ZW5zaW9uTGlzdC5jb25jYXQodGhpcy5icG1uRWxlbWVudExpc3RlbmVycykpOw0KICAgICAgICB9KQ0KICAgICAgICAvLyDlm57kvKDmmL7npLrmlbDph48NCiAgICAgICAgdGhpcy4kZW1pdCgnZ2V0VGFza0xpc3RlbmVyQ291bnQnLCB0aGlzLmVsZW1lbnRMaXN0ZW5lcnNMaXN0Lmxlbmd0aCkNCiAgICAgIH0NCiAgICAgIHRoaXMuY2hlY2tlZExpc3RlbmVyRGF0YSA9IFtdOw0KICAgICAgdGhpcy5saXN0ZW5lclN5c3RlbUNoZWNrZWQgPSB0cnVlOw0KICAgICAgLy8g6ZqQ6JeP5L6n6L655qCPDQogICAgICB0aGlzLmxpc3RlbmVyU3lzdGVtVmlzaWJsZSA9IGZhbHNlOw0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["taskListener.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4PA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"taskListener.vue","sourceRoot":"src/components/Process/panel","sourcesContent":["<template>\r\n  <div class=\"panel-tab__content\">\r\n    <el-table :data=\"elementListenersList\" border size=\"mini\">\r\n      <el-table-column label=\"序号\" width=\"50px\" type=\"index\" />\r\n      <el-table-column label=\"类型\" width=\"60px\" show-overflow-tooltip :formatter=\"row => listenerEventTypeObject[row.event]\" />\r\n<!--      <el-table-column label=\"事件id\" min-width=\"70px\" prop=\"id\" show-overflow-tooltip />-->\r\n      <el-table-column label=\"监听类型\" width=\"85px\" show-overflow-tooltip :formatter=\"row => listenerTypeObject[row.listenerType]\" />\r\n      <el-table-column label=\"操作\" >\r\n        <template  slot-scope=\"scope\">\r\n          <el-button size=\"mini\" type=\"primary\" @click=\"openListenerForm(scope.row, scope.$index)\">编辑</el-button>\r\n          <el-divider direction=\"vertical\" />\r\n          <el-button size=\"mini\" type=\"danger\" @click=\"removeListener(scope.row, scope.$index)\">移除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <div class=\"element-drawer__button_save\">\r\n      <el-button type=\"primary\" icon=\"el-icon-plus\" size=\"small\" @click=\"listenerSystemVisible = true\">内置监听器</el-button>\r\n      <el-button type=\"primary\" icon=\"el-icon-plus\" size=\"small\" @click=\"openListenerForm(null)\">自定义监听器</el-button>\r\n    </div>\r\n\r\n    <!-- 监听器 编辑/创建 部分 -->\r\n    <el-drawer :visible.sync=\"listenerFormModelVisible\" title=\"任务监听器\" size=\"480px\" append-to-body destroy-on-close>\r\n      <el-form :model=\"listenerForm\" size=\"small\" label-width=\"110px\" ref=\"listenerFormRef\" @submit.native.prevent>\r\n        <el-form-item prop=\"event\" :rules=\"{ required: true, trigger: ['blur', 'change'] }\">\r\n          <template slot=\"label\">\r\n            <span>\r\n               事件类型\r\n               <el-tooltip placement=\"top\">\r\n                  <template slot=\"content\">\r\n                     <div>\r\n                              create（创建）：当任务已经创建，并且所有任务参数都已经设置时触发。\r\n                        <br />assignment（指派）：当任务已经指派给某人时触发。请注意：当流程执行到达用户任务时，\r\n                        <br />在触发create事件之前，会首先触发assignment事件。这顺序看起来不太自然，\r\n                        <br />但是有实际原因的：当收到create事件时，我们通常希望能看到任务的所有参数，包括办理人。\r\n                        <br />complete（完成）：当任务已经完成，从运行时数据中删除前触发。\r\n                        <br />delete（删除）：在任务即将被删除前触发。请注意任务由completeTask正常完成时也会触发。\r\n                     </div>\r\n                  </template>\r\n                  <i class=\"el-icon-question\" />\r\n               </el-tooltip>\r\n            </span>\r\n          </template>\r\n          <el-select v-model=\"listenerForm.event\">\r\n            <el-option v-for=\"i in Object.keys(listenerEventTypeObject)\" :key=\"i\" :label=\"listenerEventTypeObject[i]\" :value=\"i\" />\r\n          </el-select>\r\n        </el-form-item>\r\n<!--        <el-form-item label=\"监听器ID\" prop=\"id\" :rules=\"{ required: true, trigger: ['blur', 'change'] }\">-->\r\n<!--          <el-input v-model=\"listenerForm.id\" clearable />-->\r\n<!--        </el-form-item>-->\r\n        <el-form-item label=\"监听器类型\" prop=\"listenerType\" :rules=\"{ required: true, trigger: ['blur', 'change'] }\">\r\n          <template slot=\"label\">\r\n            <span>\r\n               监听类型\r\n               <el-tooltip placement=\"top\">\r\n                  <template slot=\"content\">\r\n                     <div>\r\n                              class：需要调用的委托类。这个类必须实现org.flowable.engine.delegate.TaskListener接口。\r\n                        <br />assignment（指派）：当任务已经指派给某人时触发。请注意：当流程执行到达用户任务时，\r\n                        <br />  在触发create事件之前，会首先触发assignment事件。这顺序看起来不太自然，\r\n                        <br />  但是有实际原因的：当收到create事件时，我们通常希望能看到任务的所有参数，包括办理人。\r\n                        <br />complete（完成）：当任务已经完成，从运行时数据中删除前触发。\r\n                        <br />delete（删除）：在任务即将被删除前触发。请注意任务由completeTask正常完成时也会触发。\r\n                     </div>\r\n                  </template>\r\n                  <i class=\"el-icon-question\" />\r\n               </el-tooltip>\r\n            </span>\r\n          </template>\r\n          <el-select v-model=\"listenerForm.listenerType\">\r\n            <el-option v-for=\"i in Object.keys(listenerTypeObject)\" :key=\"i\" :label=\"listenerTypeObject[i]\" :value=\"i\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item\r\n            v-if=\"listenerForm.listenerType === 'classListener'\"\r\n            label=\"Java类\"\r\n            prop=\"class\"\r\n            key=\"listener-class\"\r\n            :rules=\"{ required: true, trigger: ['blur', 'change'] }\"\r\n        >\r\n          <el-input v-model=\"listenerForm.class\" clearable />\r\n        </el-form-item>\r\n        <el-form-item\r\n            v-if=\"listenerForm.listenerType === 'expressionListener'\"\r\n            label=\"表达式\"\r\n            prop=\"expression\"\r\n            key=\"listener-expression\"\r\n            :rules=\"{ required: true, trigger: ['blur', 'change'] }\"\r\n        >\r\n          <el-input v-model=\"listenerForm.expression\" clearable />\r\n        </el-form-item>\r\n        <el-form-item\r\n            v-if=\"listenerForm.listenerType === 'delegateExpressionListener'\"\r\n            label=\"代理表达式\"\r\n            prop=\"delegateExpression\"\r\n            key=\"listener-delegate\"\r\n            :rules=\"{ required: true, trigger: ['blur', 'change'] }\"\r\n        >\r\n          <el-input v-model=\"listenerForm.delegateExpression\" clearable />\r\n        </el-form-item>\r\n        <template v-if=\"listenerForm.listenerType === 'scriptListener'\">\r\n          <el-form-item\r\n              label=\"脚本格式\"\r\n              prop=\"scriptFormat\"\r\n              key=\"listener-script-format\"\r\n              :rules=\"{ required: true, trigger: ['blur', 'change'], message: '请填写脚本格式' }\"\r\n          >\r\n            <el-input v-model=\"listenerForm.scriptFormat\" clearable />\r\n          </el-form-item>\r\n          <el-form-item\r\n              label=\"脚本类型\"\r\n              prop=\"scriptType\"\r\n              key=\"listener-script-type\"\r\n              :rules=\"{ required: true, trigger: ['blur', 'change'], message: '请选择脚本类型' }\"\r\n          >\r\n            <el-select v-model=\"listenerForm.scriptType\">\r\n              <el-option label=\"内联脚本\" value=\"inlineScript\" />\r\n              <el-option label=\"外部脚本\" value=\"externalScript\" />\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item\r\n              v-if=\"listenerForm.scriptType === 'inlineScript'\"\r\n              label=\"脚本内容\"\r\n              prop=\"value\"\r\n              key=\"listener-script\"\r\n              :rules=\"{ required: true, trigger: ['blur', 'change'], message: '请填写脚本内容' }\"\r\n          >\r\n            <el-input v-model=\"listenerForm.value\" clearable />\r\n          </el-form-item>\r\n          <el-form-item\r\n              v-if=\"listenerForm.scriptType === 'externalScript'\"\r\n              label=\"资源地址\"\r\n              prop=\"resource\"\r\n              key=\"listener-resource\"\r\n              :rules=\"{ required: true, trigger: ['blur', 'change'], message: '请填写资源地址' }\"\r\n          >\r\n            <el-input v-model=\"listenerForm.resource\" clearable />\r\n          </el-form-item>\r\n        </template>\r\n\r\n        <template v-if=\"listenerForm.event === 'timeout'\">\r\n          <el-form-item label=\"定时器类型\" prop=\"eventDefinitionType\" key=\"eventDefinitionType\">\r\n            <el-select v-model=\"listenerForm.eventDefinitionType\">\r\n              <el-option label=\"日期\" value=\"date\" />\r\n              <el-option label=\"持续时长\" value=\"duration\" />\r\n              <el-option label=\"循环\" value=\"cycle\" />\r\n              <el-option label=\"无\" value=\"null\" />\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item\r\n              v-if=\"!!listenerForm.eventDefinitionType && listenerForm.eventDefinitionType !== 'null'\"\r\n              label=\"定时器\"\r\n              prop=\"eventTimeDefinitions\"\r\n              key=\"eventTimeDefinitions\"\r\n              :rules=\"{ required: true, trigger: ['blur', 'change'], message: '请填写定时器配置' }\"\r\n          >\r\n            <el-input v-model=\"listenerForm.eventTimeDefinitions\" clearable />\r\n          </el-form-item>\r\n        </template>\r\n      </el-form>\r\n\r\n      <el-divider />\r\n      <p class=\"listener-filed__title\">\r\n        <span><i class=\"el-icon-menu\"></i>注入字段：</span>\r\n        <el-button size=\"small\" type=\"primary\" @click=\"openListenerFieldForm(null)\">添加字段</el-button>\r\n      </p>\r\n      <el-table :data=\"fieldsListOfListener\" size=\"mini\" max-height=\"240\" border fit style=\"flex: none\">\r\n        <el-table-column label=\"序号\" width=\"50px\" type=\"index\" />\r\n        <el-table-column label=\"字段名称\" width=\"80px\" prop=\"name\" />\r\n        <el-table-column label=\"字段类型\" width=\"80px\" show-overflow-tooltip :formatter=\"row => fieldTypeObject[row.fieldType]\" />\r\n        <el-table-column label=\"值内容\" width=\"80px\" show-overflow-tooltip :formatter=\"row => row.string || row.expression\" />\r\n        <el-table-column label=\"操作\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button size=\"mini\" type=\"primary\"  @click=\"openListenerFieldForm(scope.row, scope.$index)\">编辑</el-button>\r\n            <el-divider direction=\"vertical\" />\r\n            <el-button size=\"mini\" type=\"danger\" @click=\"removeListenerField(scope.row, scope.$index)\">移除</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div class=\"element-drawer__button\">\r\n        <el-button size=\"small\" @click=\"listenerFormModelVisible = false\">取 消</el-button>\r\n        <el-button size=\"small\" type=\"primary\" @click=\"saveListenerConfig\">保 存</el-button>\r\n      </div>\r\n    </el-drawer>\r\n\r\n    <!-- 注入西段 编辑/创建 部分 -->\r\n    <el-dialog title=\"字段配置\" :visible.sync=\"listenerFieldFormModelVisible\" width=\"600px\" append-to-body destroy-on-close>\r\n      <el-form :model=\"listenerFieldForm\"  label-width=\"96px\" ref=\"listenerFieldFormRef\" style=\"height: 136px\" @submit.native.prevent>\r\n        <el-form-item label=\"字段名称：\" prop=\"name\" :rules=\"{ required: true, trigger: ['blur', 'change'] }\">\r\n          <el-input v-model=\"listenerFieldForm.name\" clearable />\r\n        </el-form-item>\r\n        <el-form-item label=\"字段类型：\" prop=\"fieldType\" :rules=\"{ required: true, trigger: ['blur', 'change'] }\">\r\n          <el-select v-model=\"listenerFieldForm.fieldType\">\r\n            <el-option v-for=\"i in Object.keys(fieldTypeObject)\" :key=\"i\" :label=\"fieldTypeObject[i]\" :value=\"i\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item\r\n            v-if=\"listenerFieldForm.fieldType === 'string'\"\r\n            label=\"字段值：\"\r\n            prop=\"string\"\r\n            key=\"field-string\"\r\n            :rules=\"{ required: true, trigger: ['blur', 'change'] }\"\r\n        >\r\n          <el-input v-model=\"listenerFieldForm.string\" clearable />\r\n        </el-form-item>\r\n        <el-form-item\r\n            v-if=\"listenerFieldForm.fieldType === 'expression'\"\r\n            label=\"表达式：\"\r\n            prop=\"expression\"\r\n            key=\"field-expression\"\r\n            :rules=\"{ required: true, trigger: ['blur', 'change'] }\"\r\n        >\r\n          <el-input v-model=\"listenerFieldForm.expression\" clearable />\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button size=\"small\" @click=\"listenerFieldFormModelVisible= false\">取 消</el-button>\r\n          <el-button size=\"small\" type=\"primary\" @click=\"saveListenerFiled\">确 定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n    <!-- 内置监听器 -->\r\n    <el-drawer :visible.sync=\"listenerSystemVisible\" title=\"任务监听器\" size=\"580px\" append-to-body destroy-on-close>\r\n      <el-table v-loading=\"loading\" :data=\"listenerList\" @selection-change=\"handleSelectionChange\">\r\n        <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\r\n        <el-table-column label=\"名称\" align=\"center\" prop=\"name\" />\r\n        <el-table-column label=\"类型\" align=\"center\" prop=\"eventType\"/>\r\n        <el-table-column label=\"监听类型\" align=\"center\" prop=\"valueType\">\r\n          <template slot-scope=\"scope\">\r\n            <dict-tag :options=\"dict.type.sys_listener_value_type\" :value=\"scope.row.valueType\"/>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"执行内容\" align=\"center\" prop=\"value\" :show-overflow-tooltip=\"true\"/>\r\n      </el-table>\r\n\r\n      <pagination\r\n          v-show=\"total>0\"\r\n          :total=\"total\"\r\n          layout=\"prev, pager, next\"\r\n          :page.sync=\"queryParams.pageNum\"\r\n          :limit.sync=\"queryParams.pageSize\"\r\n          @pagination=\"getList\"\r\n      />\r\n\r\n      <div class=\"element-drawer__button\">\r\n        <el-button size=\"small\" @click=\"listenerSystemVisible = false\">取 消</el-button>\r\n        <el-button size=\"small\" type=\"primary\" :disabled=\"listenerSystemChecked\" @click=\"saveSystemListener\">保 存</el-button>\r\n      </div>\r\n    </el-drawer>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { listListener } from \"@/api/flowable/listener\";\r\nimport {\r\n  changeListenerObject,\r\n  createListenerObject,\r\n  createSystemListenerObject,\r\n  updateElementExtensions\r\n} from \"../common/bpmnUtils\";\r\n\r\nimport {StrUtil} from \"@/utils/StrUtil\";\r\n\r\nexport default {\r\n  name: \"TaskListener\",\r\n  // 内置监听器相关信息\r\n  dicts: ['sys_listener_value_type', 'sys_listener_event_type'],\r\n  /** 组件传值  */\r\n  props : {\r\n    id: {\r\n      type: String,\r\n      required: true\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      elementListenersList: [], // 监听器列表\r\n      listenerForm: {},// 监听器详情表单\r\n      listenerFormModelVisible: false, // 监听器 编辑 侧边栏显示状态\r\n      fieldsListOfListener: [],\r\n      bpmnElementListeners: [],\r\n      otherExtensionList: [],\r\n      listenerFieldForm: {}, // 监听器 注入字段 详情表单\r\n      listenerFieldFormModelVisible: false, // 监听器 注入字段表单弹窗 显示状态\r\n      editingListenerIndex: -1, // 监听器所在下标，-1 为新增\r\n      editingListenerFieldIndex: -1, // 字段所在下标，-1 为新增\r\n\r\n      listenerList: [],\r\n      checkedListenerData: [],\r\n      listenerSystemVisible: false,\r\n      listenerSystemChecked: true,\r\n      loading: true,\r\n      total: 0,\r\n      listenerTypeObject: {\r\n        classListener: \"Java 类\",\r\n        expressionListener: \"表达式\",\r\n        delegateExpressionListener: \"代理表达式\",\r\n        scriptListener: \"脚本\"\r\n      },\r\n      listenerEventTypeObject:{\r\n        create: \"创建\",\r\n        assignment: \"指派\",\r\n        complete: \"完成\",\r\n        delete: \"删除\",\r\n        // update: \"更新\",\r\n        // timeout: \"超时\"\r\n      },\r\n      fieldTypeObject:{\r\n        string: \"字符串\",\r\n        expression: \"表达式\"\r\n      },\r\n      queryParams: {\r\n        pageNum: 1,\r\n        pageSize: 10,\r\n        type: 1,\r\n      },\r\n    }\r\n  },\r\n\r\n  /** 传值监听 */\r\n  watch: {\r\n    id: {\r\n      handler(newVal) {\r\n        if (StrUtil.isNotBlank(newVal)) {\r\n          this.resetListenersList();\r\n        }\r\n      },\r\n      immediate: true, // 立即生效\r\n    },\r\n  },\r\n  created() {\r\n    this.getList();\r\n\r\n  },\r\n  methods: {\r\n    resetListenersList() {\r\n      this.bpmnElementListeners =\r\n        this.modelerStore.element.businessObject?.extensionElements?.values?.filter(ex => ex.$type === `flowable:TaskListener`) ?? [];\r\n      this.elementListenersList = this.bpmnElementListeners.map(listener => this.initListenerType(listener));\r\n      this.$emit('getTaskListenerCount', this.elementListenersList.length)\r\n    },\r\n\r\n    // 打开 监听器详情 侧边栏\r\n    openListenerForm(listener, index) {\r\n      if (listener) {\r\n        this.listenerForm = this.initListenerForm(listener);\r\n        this.editingListenerIndex = index;\r\n      } else {\r\n        this.listenerForm = {};\r\n        this.editingListenerIndex = -1; // 标记为新增\r\n      }\r\n      if (listener && listener.fields) {\r\n        this.fieldsListOfListener = listener.fields.map(field => ({\r\n          ...field,\r\n          fieldType: field.string ? \"string\" : \"expression\"\r\n        }));\r\n      } else {\r\n        this.fieldsListOfListener = [];\r\n        this.$set(this.listenerForm, \"fields\", []);\r\n      }\r\n      // 打开侧边栏并清楚验证状态\r\n      this.listenerFormModelVisible = true;\r\n      this.$nextTick(() => {\r\n        if (this.$refs[\"listenerFormRef\"]) this.$refs[\"listenerFormRef\"].clearValidate();\r\n      });\r\n    },\r\n\r\n    // 打开监听器字段编辑弹窗\r\n    openListenerFieldForm(field, index) {\r\n      this.listenerFieldForm = field ? JSON.parse(JSON.stringify(field)) : {};\r\n      this.editingListenerFieldIndex = field ? index : -1;\r\n      this.listenerFieldFormModelVisible = true;\r\n      this.$nextTick(() => {\r\n        if (this.$refs[\"listenerFieldFormRef\"]) this.$refs[\"listenerFieldFormRef\"].clearValidate();\r\n      });\r\n    },\r\n\r\n    // 保存监听器注入字段\r\n    async saveListenerFiled() {\r\n      let validateStatus = await this.$refs[\"listenerFieldFormRef\"].validate();\r\n      if (!validateStatus) return; // 验证不通过直接返回\r\n      if (this.editingListenerFieldIndex === -1) {\r\n        this.fieldsListOfListener.push(this.listenerFieldForm);\r\n        this.listenerForm.fields.push(this.listenerFieldForm);\r\n      } else {\r\n        this.fieldsListOfListener.splice(this.editingListenerFieldIndex, 1, this.listenerFieldForm);\r\n        this.listenerForm.fields.splice(this.editingListenerFieldIndex, 1, this.listenerFieldForm);\r\n      }\r\n      this.listenerFieldFormModelVisible = false;\r\n      this.$nextTick(() => (this.listenerFieldForm = {}));\r\n    },\r\n\r\n    // 移除监听器字段\r\n    removeListenerField(field, index) {\r\n      this.$confirm(\"确认移除该字段吗？\", \"提示\", {\r\n        confirmButtonText: \"确 认\",\r\n        cancelButtonText: \"取 消\"\r\n      }).then(() => {\r\n        this.fieldsListOfListener.splice(index, 1);\r\n        this.listenerForm.fields.splice(index, 1);\r\n      }).catch(() => console.info(\"操作取消\"));\r\n    },\r\n\r\n    // 移除监听器\r\n    removeListener(listener, index) {\r\n      this.$confirm(\"确认移除该监听器吗？\", \"提示\", {\r\n        confirmButtonText: \"确 认\",\r\n        cancelButtonText: \"取 消\"\r\n      }).then(() => {\r\n        this.bpmnElementListeners.splice(index, 1);\r\n        this.elementListenersList.splice(index, 1);\r\n        updateElementExtensions(this.modelerStore.moddle, this.modelerStore.modeling, this.modelerStore.element, this.otherExtensionList.concat(this.bpmnElementListeners));\r\n        this.$emit('getTaskListenerCount', this.elementListenersList.length)\r\n      }).catch((r) => console.info(r, \"操作取消\"));\r\n    },\r\n\r\n    // 保存监听器配置\r\n    async saveListenerConfig() {\r\n      let validateStatus = await this.$refs[\"listenerFormRef\"].validate();\r\n      if (!validateStatus) return; // 验证不通过直接返回\r\n      const listenerObject = createListenerObject(this.modelerStore.moddle, this.listenerForm, false, \"flowable\");\r\n      if (this.editingListenerIndex === -1) {\r\n        this.bpmnElementListeners.push(listenerObject);\r\n        this.elementListenersList.push(this.listenerForm);\r\n      } else {\r\n        this.bpmnElementListeners.splice(this.editingListenerIndex, 1, listenerObject);\r\n        this.elementListenersList.splice(this.editingListenerIndex, 1, this.listenerForm);\r\n      }\r\n      // 保存其他配置\r\n      this.otherExtensionList = this.modelerStore.element.businessObject?.extensionElements?.values?.filter(ex => ex.$type !== `flowable:TaskListener`) ?? [];\r\n      updateElementExtensions(this.modelerStore.moddle, this.modelerStore.modeling, this.modelerStore.element, this.otherExtensionList.concat(this.bpmnElementListeners));\r\n      this.$emit('getTaskListenerCount', this.elementListenersList.length)\r\n      // 4. 隐藏侧边栏\r\n      this.listenerFormModelVisible = false;\r\n      this.listenerForm = {};\r\n    },\r\n\r\n    initListenerType(listener) {\r\n      let listenerType;\r\n      if (listener.class) listenerType = \"classListener\";\r\n      if (listener.expression) listenerType = \"expressionListener\";\r\n      if (listener.delegateExpression) listenerType = \"delegateExpressionListener\";\r\n      if (listener.script) listenerType = \"scriptListener\";\r\n      return {\r\n        ...JSON.parse(JSON.stringify(listener)),\r\n        ...(listener.script ?? {}),\r\n        listenerType: listenerType\r\n      };\r\n    },\r\n\r\n    // 初始化表单数据\r\n    initListenerForm(listener) {\r\n      let self = {\r\n        ...listener\r\n      };\r\n      if (listener.script) {\r\n        self = {\r\n          ...listener,\r\n          ...listener.script,\r\n          scriptType: listener.script.resource ? \"externalScript\" : \"inlineScript\"\r\n        };\r\n      }\r\n      if (listener.event === \"timeout\" && listener.eventDefinitions) {\r\n        if (listener.eventDefinitions.length) {\r\n          let k = \"\";\r\n          for (let key in listener.eventDefinitions[0]) {\r\n            console.log(listener.eventDefinitions, key);\r\n            if (key.indexOf(\"time\") !== -1) {\r\n              k = key;\r\n              self.eventDefinitionType = key.replace(\"time\", \"\").toLowerCase();\r\n            }\r\n          }\r\n          console.log(k);\r\n          self.eventTimeDefinitions = listener.eventDefinitions[0][k].body;\r\n        }\r\n      }\r\n      return self;\r\n    },\r\n\r\n\r\n    /** 查询流程达式列表 */\r\n    getList() {\r\n      this.loading = true;\r\n      listListener(this.queryParams).then(response => {\r\n        this.listenerList = response.rows;\r\n        this.total = response.total;\r\n        this.loading = false;\r\n      });\r\n    },\r\n\r\n    // 多选框选中数据\r\n    handleSelectionChange(selection) {\r\n      // ids.value = selection.map(item => item.id);\r\n      // TODO 应该使用 push?\r\n      this.checkedListenerData = selection;\r\n      this.listenerSystemChecked = selection.length !== 1;\r\n    },\r\n\r\n    // 保存内置监听器\r\n    saveSystemListener() {\r\n      if (this.checkedListenerData.length > 0) {\r\n        this.checkedListenerData.forEach(value => {\r\n          // 保存其他配置\r\n          const listenerObject = createSystemListenerObject(this.modelerStore.moddle, value, true, \"flowable\");\r\n          this.bpmnElementListeners.push(listenerObject);\r\n          this.elementListenersList.push(changeListenerObject(value));\r\n          this.otherExtensionList = this.modelerStore.element.businessObject?.extensionElements?.values?.filter(ex => ex.$type !== `flowable:TaskListener`) ?? [];\r\n          updateElementExtensions(this.modelerStore.moddle, this.modelerStore.modeling, this.modelerStore.element, this.otherExtensionList.concat(this.bpmnElementListeners));\r\n        })\r\n        // 回传显示数量\r\n        this.$emit('getTaskListenerCount', this.elementListenersList.length)\r\n      }\r\n      this.checkedListenerData = [];\r\n      this.listenerSystemChecked = true;\r\n      // 隐藏侧边栏\r\n      this.listenerSystemVisible = false;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n@import '../style/process-panel';\r\n.flow-containers  .el-badge__content.is-fixed {\r\n  top: 18px;\r\n}\r\n.dialog-footer button:first-child {\r\n  margin-right: 10px;\r\n}\r\n</style>\r\n"]}]}