{"remainingRequest":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\src\\components\\Process\\panel\\conditionPanel.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\src\\components\\Process\\panel\\conditionPanel.vue","mtime":1733705220395},{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\chenxi\\Desktop\\pro\\QingXinSaaS\\qingxinsaas-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQoNCmltcG9ydCB7U3RyVXRpbH0gZnJvbSAiQC91dGlscy9TdHJVdGlsIjsNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIkJwbW5Nb2RlbCIsDQogIC8qKiDnu4Tku7bkvKDlgLwgICovDQogIHByb3BzIDogew0KICAgIGlkOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICByZXF1aXJlZDogdHJ1ZQ0KICAgIH0sDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGJwbW5FbGVtZW50U291cmNlOiB7fSwNCiAgICAgIGJwbW5FbGVtZW50U291cmNlUmVmOiB7fSwNCiAgICAgIGJwbW5Gb3JtRGF0YToge30NCiAgICB9DQogIH0sDQoNCiAgLyoqIOS8oOWAvOebkeWQrCAqLw0KICB3YXRjaDogew0KICAgIGlkOiB7DQogICAgICBoYW5kbGVyKG5ld1ZhbCkgew0KICAgICAgICBpZiAoU3RyVXRpbC5pc05vdEJsYW5rKG5ld1ZhbCkpIHsNCiAgICAgICAgICB0aGlzLnJlc2V0Rmxvd0NvbmRpdGlvbigpOw0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgaW1tZWRpYXRlOiB0cnVlLCAvLyDnq4vljbPnlJ/mlYgNCiAgICB9LA0KICB9LA0KICBjcmVhdGVkKCkgew0KDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvLyDmlrnms5XljLoNCiAgICByZXNldEZsb3dDb25kaXRpb24oKSB7DQogICAgICB0aGlzLmJwbW5Gb3JtRGF0YSA9IHsNCiAgICAgICAgYm9keTogbnVsbA0KICAgICAgfTsNCiAgICAgIHRoaXMuYnBtbkVsZW1lbnRTb3VyY2UgPSB0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LnNvdXJjZTsNCiAgICAgIHRoaXMuYnBtbkVsZW1lbnRTb3VyY2VSZWYgPSB0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LmJ1c2luZXNzT2JqZWN0LnNvdXJjZVJlZjsNCiAgICAgIGlmICh0aGlzLmJwbW5FbGVtZW50U291cmNlUmVmICYmIHRoaXMuYnBtbkVsZW1lbnRTb3VyY2VSZWYuZGVmYXVsdCAmJiB0aGlzLmJwbW5FbGVtZW50U291cmNlUmVmLmRlZmF1bHQuaWQgPT09IHRoaXMubW9kZWxlclN0b3JlLmVsZW1lbnQuaWQpIHsNCiAgICAgICAgLy8g6buY6K6kDQogICAgICAgIHRoaXMuJHNldCh0aGlzLmJwbW5Gb3JtRGF0YSwgInR5cGUiLCAiZGVmYXVsdCIpOw0KICAgICAgfSBlbHNlIGlmICghdGhpcy5tb2RlbGVyU3RvcmUuZWxlbWVudC5idXNpbmVzc09iamVjdC5jb25kaXRpb25FeHByZXNzaW9uKSB7DQogICAgICAgIC8vIOaZrumAmg0KICAgICAgICB0aGlzLiRzZXQodGhpcy5icG1uRm9ybURhdGEsICJ0eXBlIiwgIm5vcm1hbCIpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8g5bim5p2h5Lu2DQogICAgICAgIGNvbnN0IGNvbmRpdGlvbkV4cHJlc3Npb24gPSB0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LmJ1c2luZXNzT2JqZWN0LmNvbmRpdGlvbkV4cHJlc3Npb247DQogICAgICAgIHRoaXMuYnBtbkZvcm1EYXRhID0gey4uLmNvbmRpdGlvbkV4cHJlc3Npb24sIHR5cGU6ICJjb25kaXRpb24ifTsNCiAgICAgICAgLy8gcmVzb3VyY2Ug5Y+v55u05o6l5qCH6K+GIOaYr+WQpuaYr+WklumDqOi1hOa6kOiEmuacrA0KICAgICAgICBpZiAodGhpcy5icG1uRm9ybURhdGEucmVzb3VyY2UpIHsNCiAgICAgICAgICB0aGlzLiRzZXQodGhpcy5icG1uRm9ybURhdGEsICJjb25kaXRpb25UeXBlIiwgInNjcmlwdCIpOw0KICAgICAgICAgIHRoaXMuJHNldCh0aGlzLmJwbW5Gb3JtRGF0YSwgInNjcmlwdFR5cGUiLCAiZXh0ZXJuYWxTY3JpcHQiKTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvbmRpdGlvbkV4cHJlc3Npb24ubGFuZ3VhZ2UpIHsNCiAgICAgICAgICB0aGlzLiRzZXQodGhpcy5icG1uRm9ybURhdGEsICJjb25kaXRpb25UeXBlIiwgInNjcmlwdCIpOw0KICAgICAgICAgIHRoaXMuJHNldCh0aGlzLmJwbW5Gb3JtRGF0YSwgInNjcmlwdFR5cGUiLCAiaW5saW5lU2NyaXB0Iik7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuJHNldCh0aGlzLmJwbW5Gb3JtRGF0YSwgImNvbmRpdGlvblR5cGUiLCAiZXhwcmVzc2lvbiIpOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICB1cGRhdGVGbG93VHlwZShmbG93VHlwZSkgew0KICAgICAgLy8g5q2j5bi45p2h5Lu257G7DQogICAgICBpZiAoZmxvd1R5cGUgPT09ICJjb25kaXRpb24iKSB7DQogICAgICAgIGNvbnN0IGZsb3dDb25kaXRpb25SZWYgPSB0aGlzLm1vZGVsZXJTdG9yZS5tb2RkbGUuY3JlYXRlKCJicG1uOkZvcm1hbEV4cHJlc3Npb24iKTsNCiAgICAgICAgdGhpcy5tb2RlbGVyU3RvcmUubW9kZWxpbmcudXBkYXRlUHJvcGVydGllcyh0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LCB7DQogICAgICAgICAgY29uZGl0aW9uRXhwcmVzc2lvbjogZmxvd0NvbmRpdGlvblJlZg0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgLy8g6buY6K6k6Lev5b6EDQogICAgICBpZiAoZmxvd1R5cGUgPT09ICJkZWZhdWx0Iikgew0KICAgICAgICB0aGlzLm1vZGVsZXJTdG9yZS5tb2RlbGluZy51cGRhdGVQcm9wZXJ0aWVzKHRoaXMubW9kZWxlclN0b3JlLmVsZW1lbnQsIHsNCiAgICAgICAgICBjb25kaXRpb25FeHByZXNzaW9uOiBudWxsDQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLm1vZGVsZXJTdG9yZS5tb2RlbGluZy51cGRhdGVQcm9wZXJ0aWVzKHRoaXMuYnBtbkVsZW1lbnRTb3VyY2UsIHsNCiAgICAgICAgICBkZWZhdWx0OiB0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50DQogICAgICAgIH0pOw0KICAgICAgICAvLyDmuIXnqbrmnaHku7bmoLzlvI8NCiAgICAgICAgdGhpcy5icG1uRm9ybURhdGEuY29uZGl0aW9uVHlwZSA9IG51bGw7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIC8vIOa4heepuuadoeS7tuagvOW8jw0KICAgICAgdGhpcy5icG1uRm9ybURhdGEuY29uZGl0aW9uVHlwZSA9IG51bGw7DQogICAgICAvLyDmraPluLjot6/lvoTvvIzlpoLmnpzmnaXmupDoioLngrnnmoTpu5jorqTot6/lvoTmmK/lvZPliY3ov57nur/ml7bvvIzmuIXpmaTniLblhYPntKDnmoTpu5jorqTot6/lvoTphY3nva4NCiAgICAgIGlmICh0aGlzLmJwbW5FbGVtZW50U291cmNlUmVmLmRlZmF1bHQgJiYgdGhpcy5icG1uRWxlbWVudFNvdXJjZVJlZi5kZWZhdWx0LmlkID09PSB0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LmlkKSB7DQogICAgICAgIHRoaXMubW9kZWxlclN0b3JlLm1vZGVsaW5nLnVwZGF0ZVByb3BlcnRpZXModGhpcy5icG1uRWxlbWVudFNvdXJjZSwgew0KICAgICAgICAgIGRlZmF1bHQ6IG51bGwNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgICB0aGlzLm1vZGVsZXJTdG9yZS5tb2RlbGluZy51cGRhdGVQcm9wZXJ0aWVzKHRoaXMubW9kZWxlclN0b3JlLmVsZW1lbnQsIHsNCiAgICAgICAgY29uZGl0aW9uRXhwcmVzc2lvbjogbnVsbA0KICAgICAgfSk7DQogICAgfSwNCg0KICAgIHVwZGF0ZUZsb3dDb25kaXRpb24oKSB7DQogICAgICBsZXQge2NvbmRpdGlvblR5cGUsIHNjcmlwdFR5cGUsIGJvZHksIHJlc291cmNlLCBsYW5ndWFnZX0gPSB0aGlzLmJwbW5Gb3JtRGF0YTsNCiAgICAgIGxldCBjb25kaXRpb247DQogICAgICBpZiAoY29uZGl0aW9uVHlwZSA9PT0gImV4cHJlc3Npb24iKSB7DQogICAgICAgIGNvbmRpdGlvbiA9IHRoaXMubW9kZWxlclN0b3JlLm1vZGRsZS5jcmVhdGUoImJwbW46Rm9ybWFsRXhwcmVzc2lvbiIsIHtib2R5fSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoc2NyaXB0VHlwZSA9PT0gImlubGluZVNjcmlwdCIpIHsNCiAgICAgICAgICBjb25kaXRpb24gPSB0aGlzLm1vZGVsZXJTdG9yZS5tb2RkbGUuY3JlYXRlKCJicG1uOkZvcm1hbEV4cHJlc3Npb24iLCB7Ym9keSwgbGFuZ3VhZ2V9KTsNCiAgICAgICAgICB0aGlzLiRzZXQodGhpcy5icG1uRm9ybURhdGEsICJyZXNvdXJjZSIsICIiKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLiRzZXQodGhpcy5icG1uRm9ybURhdGEsICJib2R5IiwgIiIpOw0KICAgICAgICAgIGNvbmRpdGlvbiA9IHRoaXMubW9kZWxlclN0b3JlLm1vZGRsZS5jcmVhdGUoImJwbW46Rm9ybWFsRXhwcmVzc2lvbiIsIHtyZXNvdXJjZSwgbGFuZ3VhZ2V9KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdGhpcy5tb2RlbGVyU3RvcmUubW9kZWxpbmcudXBkYXRlUHJvcGVydGllcyh0aGlzLm1vZGVsZXJTdG9yZS5lbGVtZW50LCB7Y29uZGl0aW9uRXhwcmVzc2lvbjogY29uZGl0aW9ufSk7DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["conditionPanel.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"conditionPanel.vue","sourceRoot":"src/components/Process/panel","sourcesContent":["<template>\r\n  <div>\r\n    <el-form label-width=\"100px\" size=\"small\" @submit.native.prevent>\r\n      <el-form-item>\r\n        <template slot=\"label\">\r\n            <span>\r\n               流转类型\r\n               <el-tooltip placement=\"top\">\r\n                  <template slot=\"content\">\r\n                     <div>\r\n                              普通流转路径：流程执行过程中，一个元素被访问后，会沿着其所有出口顺序流继续执行。\r\n                        <br />默认流转路径：只有当没有其他顺序流可以选择时，才会选择默认顺序流作为活动的出口顺序流。流程会忽略默认顺序流上的条件。\r\n                        <br />条件流转路径：是计算其每个出口顺序流上的条件。当条件计算为true时，选择该出口顺序流。如果该方法选择了多条顺序流，则会生成多个执行，流程会以并行方式继续。\r\n                     </div>\r\n                  </template>\r\n                  <i class=\"el-icon-question\" />\r\n               </el-tooltip>\r\n            </span>\r\n        </template>\r\n        <el-select v-model=\"bpmnFormData.type\" @change=\"updateFlowType\">\r\n          <el-option label=\"普通流转路径\" value=\"normal\" />\r\n          <el-option label=\"默认流转路径\" value=\"default\" />\r\n          <el-option label=\"条件流转路径\" value=\"condition\" />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"条件格式\" v-if=\"bpmnFormData.type === 'condition'\" key=\"condition\">\r\n        <el-select v-model=\"bpmnFormData.conditionType\">\r\n          <el-option label=\"表达式\" value=\"expression\" />\r\n          <el-option label=\"脚本\" value=\"script\" />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"表达式\" v-if=\"bpmnFormData.conditionType && bpmnFormData.conditionType === 'expression'\" key=\"express\">\r\n        <el-input v-model=\"bpmnFormData.body\" clearable @change=\"updateFlowCondition\" />\r\n      </el-form-item>\r\n      <template v-if=\"bpmnFormData.conditionType && bpmnFormData.conditionType === 'script'\">\r\n        <el-form-item label=\"脚本语言\" key=\"language\">\r\n          <el-input v-model=\"bpmnFormData.language\" clearable @change=\"updateFlowCondition\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"脚本类型\" key=\"scriptType\">\r\n          <el-select v-model=\"bpmnFormData.scriptType\">\r\n            <el-option label=\"内联脚本\" value=\"inlineScript\" />\r\n            <el-option label=\"外部脚本\" value=\"externalScript\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"脚本\" v-if=\"bpmnFormData.scriptType === 'inlineScript'\" key=\"body\">\r\n          <el-input v-model=\"bpmnFormData.body\" type=\"textarea\" clearable @change=\"updateFlowCondition\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"资源地址\" v-if=\"bpmnFormData.scriptType === 'externalScript'\" key=\"resource\">\r\n          <el-input v-model=\"bpmnFormData.resource\" clearable @change=\"updateFlowCondition\" />\r\n        </el-form-item>\r\n      </template>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport {StrUtil} from \"@/utils/StrUtil\";\r\nexport default {\r\n  name: \"BpmnModel\",\r\n  /** 组件传值  */\r\n  props : {\r\n    id: {\r\n      type: String,\r\n      required: true\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      bpmnElementSource: {},\r\n      bpmnElementSourceRef: {},\r\n      bpmnFormData: {}\r\n    }\r\n  },\r\n\r\n  /** 传值监听 */\r\n  watch: {\r\n    id: {\r\n      handler(newVal) {\r\n        if (StrUtil.isNotBlank(newVal)) {\r\n          this.resetFlowCondition();\r\n        }\r\n      },\r\n      immediate: true, // 立即生效\r\n    },\r\n  },\r\n  created() {\r\n\r\n  },\r\n  methods: {\r\n    // 方法区\r\n    resetFlowCondition() {\r\n      this.bpmnFormData = {\r\n        body: null\r\n      };\r\n      this.bpmnElementSource = this.modelerStore.element.source;\r\n      this.bpmnElementSourceRef = this.modelerStore.element.businessObject.sourceRef;\r\n      if (this.bpmnElementSourceRef && this.bpmnElementSourceRef.default && this.bpmnElementSourceRef.default.id === this.modelerStore.element.id) {\r\n        // 默认\r\n        this.$set(this.bpmnFormData, \"type\", \"default\");\r\n      } else if (!this.modelerStore.element.businessObject.conditionExpression) {\r\n        // 普通\r\n        this.$set(this.bpmnFormData, \"type\", \"normal\");\r\n      } else {\r\n        // 带条件\r\n        const conditionExpression = this.modelerStore.element.businessObject.conditionExpression;\r\n        this.bpmnFormData = {...conditionExpression, type: \"condition\"};\r\n        // resource 可直接标识 是否是外部资源脚本\r\n        if (this.bpmnFormData.resource) {\r\n          this.$set(this.bpmnFormData, \"conditionType\", \"script\");\r\n          this.$set(this.bpmnFormData, \"scriptType\", \"externalScript\");\r\n          return;\r\n        }\r\n        if (conditionExpression.language) {\r\n          this.$set(this.bpmnFormData, \"conditionType\", \"script\");\r\n          this.$set(this.bpmnFormData, \"scriptType\", \"inlineScript\");\r\n          return;\r\n        }\r\n        this.$set(this.bpmnFormData, \"conditionType\", \"expression\");\r\n      }\r\n    },\r\n\r\n    updateFlowType(flowType) {\r\n      // 正常条件类\r\n      if (flowType === \"condition\") {\r\n        const flowConditionRef = this.modelerStore.moddle.create(\"bpmn:FormalExpression\");\r\n        this.modelerStore.modeling.updateProperties(this.modelerStore.element, {\r\n          conditionExpression: flowConditionRef\r\n        });\r\n        return;\r\n      }\r\n      // 默认路径\r\n      if (flowType === \"default\") {\r\n        this.modelerStore.modeling.updateProperties(this.modelerStore.element, {\r\n          conditionExpression: null\r\n        });\r\n        this.modelerStore.modeling.updateProperties(this.bpmnElementSource, {\r\n          default: this.modelerStore.element\r\n        });\r\n        // 清空条件格式\r\n        this.bpmnFormData.conditionType = null;\r\n        return;\r\n      }\r\n      // 清空条件格式\r\n      this.bpmnFormData.conditionType = null;\r\n      // 正常路径，如果来源节点的默认路径是当前连线时，清除父元素的默认路径配置\r\n      if (this.bpmnElementSourceRef.default && this.bpmnElementSourceRef.default.id === this.modelerStore.element.id) {\r\n        this.modelerStore.modeling.updateProperties(this.bpmnElementSource, {\r\n          default: null\r\n        });\r\n      }\r\n      this.modelerStore.modeling.updateProperties(this.modelerStore.element, {\r\n        conditionExpression: null\r\n      });\r\n    },\r\n\r\n    updateFlowCondition() {\r\n      let {conditionType, scriptType, body, resource, language} = this.bpmnFormData;\r\n      let condition;\r\n      if (conditionType === \"expression\") {\r\n        condition = this.modelerStore.moddle.create(\"bpmn:FormalExpression\", {body});\r\n      } else {\r\n        if (scriptType === \"inlineScript\") {\r\n          condition = this.modelerStore.moddle.create(\"bpmn:FormalExpression\", {body, language});\r\n          this.$set(this.bpmnFormData, \"resource\", \"\");\r\n        } else {\r\n          this.$set(this.bpmnFormData, \"body\", \"\");\r\n          condition = this.modelerStore.moddle.create(\"bpmn:FormalExpression\", {resource, language});\r\n        }\r\n      }\r\n      this.modelerStore.modeling.updateProperties(this.modelerStore.element, {conditionExpression: condition});\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}